import re
import logging
import asyncio
from datetime import datetime, timedelta
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, filters, CallbackContext, ConversationHandler
from telegram.error import TimedOut, NetworkError
import database as db
import os
import logging
from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
TOKEN = os.environ.get('BOT_TOKEN')

if not TOKEN:
    print("–û–®–ò–ë–ö–ê: –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é BOT_TOKEN")
    exit(1)

print("–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å —Ç–æ–∫–µ–Ω–æ–º –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")

logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
# ================== –ù–ê–°–¢–†–û–ô–ö–ò ==================
ADMIN_IDS = [516406248]

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
REQUEST_TIMEOUT = 30.0

# –°–ª–æ–≤–∞—Ä—å –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É—á–∏—Ç–µ–ª–µ–π
TEACHER_IDS = {
    '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.': 1665763898,
    '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.': 1970780275,
    '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø.': 7241182510,
    '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.': 0,
    '–°–∏–≤—ã–π –ê.–í.': 0,
    '–ü–∏–Ω—á—É–∫ –ê.–í.': 0,
    '–Æ–Ω–∞—Ö –¢.–í.': 0,
    '–ë–µ–ª—å—Å–∫–∏–π –°.–í.': 0,
    '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.': 0,
    '–ë—Ä–µ–ª—å –Æ.–í.': 0,
    '–®–∞—Ç–∏–ª–æ –ù.–ò.': 0,
    '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.': 0,
    '–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.': 0,
    '–ú–µ–ª–µ–∂ –ê.–ì.': 0,
    '–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.': 0,
    '–ü—Ä–∏—Ö–∞—á –ï.–í.': 967925839,
    '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.': 0,
    '–Ø–≤–æ—à –°.–í.': 0,
    '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.': 0,
    '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.': 0,
    '–ì—É–¥ –Æ.–ü.': 516406248,
    '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.': 0,
    '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.': 0,
    '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.': 0,
    '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.': 0,
    '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.': 0,
    '–ì—Ä–∏—Ü–∫–µ–≤–∏—á –õ.–í.': 0,
    '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.': 0,
    '–ó—É–±–æ–∫ –°.–ù.': 0,
    '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.': 0,
    '–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.': 0,
    '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.': 0,
    '–õ—É–∫—å—è–Ω–µ–Ω–∫–æ –õ.–ò.': 0,
    '–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.': 0,
    '–ê—Ä—Ç—é—Ö –ú.–ü.': 0,
    '–•–æ—Ä–æ—à–∫–æ –¢.–ê.': 0
}

# –°–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Å–æ–≤
ALL_CLASSES = ['5–∞', '5–±', '5–≤', '6–∞', '6–±', '6–≤', '7–∞', '7–±', '7–≤', '8–∞', '8–±', '9–∞', '9–±', '10–∞', '10–±', '11']

# –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞
SUBJECTS = [
    "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞(–ø—Ä–æ—Ñ.)", "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫(–ø—Ä–æ—Ñ.)",
    "–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫", "–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫(–ø—Ä–æ—Ñ.)", "–†—É—Å—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", 
    "–ë–µ–ª–æ—Ä—É—Å—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", "–§–∏–∑–∏–∫–∞", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞",
    "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫", "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫(–ø—Ä–æ—Ñ.)", "–•–∏–º–∏—è", "–•–∏–º–∏—è(–ø—Ä–æ—Ñ.)",
    "–ë–∏–æ–ª–æ–≥–∏—è", "–ë–∏–æ–ª–æ–≥–∏—è(–ø—Ä–æ—Ñ.)", "–û–±—â–µ—Å—Ç–≤–æ–≤–µ–¥–µ–Ω–∏–µ", "–û–±—â–µ—Å—Ç–≤–æ–≤–µ–¥–µ–Ω–∏–µ(–ø—Ä–æ—Ñ.)",
    "–ò—Å—Ç–æ—Ä–∏—è", "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è", "–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞", "–û–ë–ñ", "–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ", 
    "–ò—Å–∫—É—Å—Å—Ç–≤–æ", "–ê—Å—Ç—Ä–æ–Ω–æ–º–∏—è", "–ß–ó–°", "–ß–µ—Ä—á–µ–Ω–∏–µ", "–î–ü", "–ú–ü", "–ß–µ–ª–æ–≤–µ–∫ –∏ –º–∏—Ä"

]

# –î–Ω–∏ –Ω–µ–¥–µ–ª–∏
DAYS_OF_WEEK = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞"]

# –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤ –≤ HTML —Ñ–æ—Ä–º–∞—Ç–µ
BELLS_SCHEDULE_HTML = """
<b>üïê –†–ê–°–ü–ò–°–ê–ù–ò–ï –ó–í–û–ù–ö–û–í –ò –ü–ò–¢–ê–ù–ò–Ø</b>
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üîî <b>1 —É—Ä–æ–∫:</b>   08:00 ‚Äì 08:45
üîî <b>2 —É—Ä–æ–∫:</b>   09:00 ‚Äì 09:45
üîî <b>3 —É—Ä–æ–∫:</b>   10:00 ‚Äì 10:45
   üçΩÔ∏è <b>–û–±–µ–¥ –¥–ª—è 5-7 –∫–ª–∞—Å—Å–æ–≤</b>
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üîî <b>4 —É—Ä–æ–∫:</b>   11:00 ‚Äì 11:45
   üçΩÔ∏è <b>–û–±–µ–¥ –¥–ª—è 8-11 –∫–ª–∞—Å—Å–æ–≤</b>
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üîî <b>5 —É—Ä–æ–∫:</b>   12:00 ‚Äì 12:45
üîî <b>6 —É—Ä–æ–∫:</b>   12:55 ‚Äì 13:40
   üçé <b>–ü–æ–ª–¥–Ω–∏–∫ –¥–ª—è –≤—Å–µ—Ö</b>
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üîî <b>7 —É—Ä–æ–∫:</b>   14:00 ‚Äì 14:45
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
"""

# ================== –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï ==================
SCHEDULE_STRUCTURED = {
    '5–∞': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (2, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (3, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.'),
            (4, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (5, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (3, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (4, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (5, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–û–ë–ñ', '–Æ–Ω–∞—Ö –¢.–í.'),
            (2, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (3, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (5, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.'),
            (6, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (2, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (3, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (5, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (2, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (3, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (5, '–ß–µ–ª–æ–≤–µ–∫ –∏ –º–∏—Ä', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.'),
            (6, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.')
        ]
    },
    '5–±': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (2, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (3, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (4, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (5, '–û–ë–ñ', '–Æ–Ω–∞—Ö –¢.–í.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (2, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (5, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (6, '–ß–µ–ª–æ–≤–µ–∫ –∏ –º–∏—Ä', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (2, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (3, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (4, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.'),
            (5, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (2, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (3, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (4, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (6, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (3, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
            (4, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (5, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ë—Ä–µ–ª—å –Æ.–í.')
        ]
    },
    '5–≤': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (3, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (5, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (6, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (2, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (4, '–ß–µ–ª–æ–≤–µ–∫ –∏ –º–∏—Ä', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.'),
            (5, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (2, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (4, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (5, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (3, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (6, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–û–ë–ñ', '–Æ–Ω–∞—Ö –¢.–í.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (3, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (4, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.')
        ]
    },
    '6–∞': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (2, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (3, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (4, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
            (5, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (6, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (3, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (4, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (6, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (2, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (3, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (6, '–†—É—Å—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (2, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ú–µ–ª–µ–∂ –ê.–ì.'),
            (3, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (4, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (5, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (2, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
            (3, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (4, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (6, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.')
        ]
    },
    '6–±': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (3, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (4, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (5, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (2, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ú–µ–ª–µ–∂ –ê.–ì.'),
            (3, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.'),
            (4, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (5, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (6, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (2, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (4, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (5, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (6, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (2, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (3, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (4, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.'),
            (5, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (6, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (2, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.'),
            (3, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (4, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (5, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (6, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.')
        ]
    },
    '6–≤': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (2, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (3, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (4, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (6, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (3, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (4, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ì—Ä–∏—Ü–∫–µ–≤–∏—á –õ.–í.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì—Ä–∏—Ü–∫–µ–≤–∏—á –õ.–í.'),
            (6, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ú–µ–ª–µ–∂ –ê.–ì.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.'),
            (2, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ì—Ä–∏—Ü–∫–µ–≤–∏—á –õ.–í.'),
            (3, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì—Ä–∏—Ü–∫–µ–≤–∏—á –õ.–í.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (5, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (2, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (4, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (5, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (6, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì—Ä–∏—Ü–∫–µ–≤–∏—á –õ.–í.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (2, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–∏—Ö–∞—Å—ë–≤ –í.–ê./–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.'),
            (5, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–∏—Ö–∞—Å—ë–≤ –í.–ê./–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (6, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.')
        ]
    },
    '7–∞': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (2, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (3, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.'),
            (4, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (6, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (7, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (2, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (3, '–§–∏–∑–∏–∫–∞', '–ó—É–±–æ–∫ –°.–ù.'),
            (4, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (6, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (2, '–§–∏–∑–∏–∫–∞', '–ó—É–±–æ–∫ –°.–ù.'),
            (3, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (5, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (6, '–•–∏–º–∏—è', '–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (7, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (2, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (3, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.'),
            (4, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (6, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (2, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (3, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ú–µ–ª–µ–∂ –ê.–ì.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (5, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.'),
            (6, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.')
        ]
    },
    '7–±': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (2, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (3, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (4, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (5, '–ë–∏–æ–ª–æ–≥–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (6, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (2, '–§–∏–∑–∏–∫–∞', '–ó—É–±–æ–∫ –°.–ù.'),
            (3, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (4, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ú–µ–ª–µ–∂ –ê.–ì.'),
            (5, '–ë–∏–æ–ª–æ–≥–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (6, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.'),
            (2, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì–∞–ø–æ–Ω–µ–Ω–∫–æ –Æ.–í.'),
            (3, '–§–∏–∑–∏–∫–∞', '–ó—É–±–æ–∫ –°.–ù.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (5, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (6, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.'),
            (2, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (3, '–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (4, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (6, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (7, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†.'),
            (2, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (4, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (5, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.')
        ]
    },
    '7–≤': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.'),
            (2, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (3, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (4, '–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (5, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.'),
            (6, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.'),
            (3, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (4, '–§–∏–∑–∏–∫–∞', '–ó—É–±–æ–∫ –°.–ù.'),
            (5, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ú–µ–ª–µ–∂ –ê.–ì.'),
            (6, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–§–∏–∑–∏–∫–∞', '–ó—É–±–æ–∫ –°.–ù.'),
            (2, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (3, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.'),
            (6, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.'),
            (3, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (4, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (6, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.'),
            (2, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (3, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.'),
            (4, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (6, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.')
        ]
    },
    '8–∞': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (2, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.'),
            (5, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (6, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–®–∞—Ç–∏–ª–æ –ù.–ò.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ì—Ä–∏—Ü–∫–µ–≤–∏—á –õ.–í.'),
            (2, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (3, '–ë–∏–æ–ª–æ–≥–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (5, '–•–∏–º–∏—è', '–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (6, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì—Ä–∏—Ü–∫–µ–≤–∏—á –õ.–í.'),
            (7, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (2, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (3, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.'),
            (4, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–®–∞—Ç–∏–ª–æ –ù.–ò.'),
            (5, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (6, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.'),
            (7, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ë–∏–æ–ª–æ–≥–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (2, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (4, '–•–∏–º–∏—è', '–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ì—Ä–∏—Ü–∫–µ–≤–∏—á –õ.–í.'),
            (6, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–®–∞—Ç–∏–ª–æ –ù.–ò.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–®—Ç—ã—Ö–Ω–æ–≤–∞ –õ.–ì.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (3, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (4, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (5, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö./–ì—É–¥ –Æ.–ü.'),
            (6, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.')
        ]
    },
    '8–±': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (2, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (4, '–ò—Å—Ç–æ—Ä–∏—è', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.'),
            (5, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (6, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (2, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (3, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (5, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (6, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (3, '–ò—Å—Ç–æ—Ä–∏—è', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.'),
            (4, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (5, '–•–∏–º–∏—è', '–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (6, '–ë–∏–æ–ª–æ–≥–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (7, '–ò—Å–∫—É—Å—Å—Ç–≤–æ', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (3, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (4, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (5, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (6, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ë—Ä–µ–ª—å –Æ.–í.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–ë–∏–æ–ª–æ–≥–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (3, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (4, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ú–∏—Ö–∞–ª–∫–æ –ï.–ü.'),
            (5, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (6, '–•–∏–º–∏—è', '–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.')
        ]
    },
    '9–∞': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (2, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.'),
            (3, '–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (4, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (5, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (6, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (7, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–§–∏–∑–∏–∫–∞', '–ó—É–±–æ–∫ –°.–ù.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (3, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (4, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ—É–∫—å—è–Ω–µ–Ω–∫–æ –õ.–ò.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ—É–∫—å—è–Ω–µ–Ω–∫–æ –õ.–ò.'),
            (6, '–û–±—â–µ—Å—Ç–≤–æ–≤–µ–¥–µ–Ω–∏–µ', '–°–∏–≤—ã–π –ê.–í.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.'),
            (2, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.'),
            (3, '–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (5, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ—É–∫—å—è–Ω–µ–Ω–∫–æ –õ.–ò.'),
            (6, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (7, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ—É–∫—å—è–Ω–µ–Ω–∫–æ –õ.–ò.'),
            (2, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø./–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.'),
            (5, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (6, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (7, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–§–∏–∑–∏–∫–∞', '–ó—É–±–æ–∫ –°.–ù.'),
            (2, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ê–Ω–∏—Å–∫–æ–≤–µ—Ü –ù.–í.'),
            (4, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (5, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (6, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ù–µ—á–∞–µ–≤–∞ –ï.–Ø.')
        ]
    },
    '9–±': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (2, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (3, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (4, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (5, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.'),
            (6, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (2, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (3, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (4, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (5, '–ò—Å—Ç–æ—Ä–∏—è', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.'),
            (6, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.'),
            (7, '–û–±—â–µ—Å—Ç–≤–æ–≤–µ–¥–µ–Ω–∏–µ', '–°–∏–≤—ã–π –ê.–í.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ë—Ä–µ–ª—å –Æ.–í.'),
            (2, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (3, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.'),
            (5, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (6, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (2, '–ë–∏–æ–ª–æ–≥–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.'),
            (3, '–¢—Ä—É–¥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ú–µ–ª–µ–∂ –ê.–ì./–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (4, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.'),
            (6, '–ò—Å—Ç–æ—Ä–∏—è', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü.'),
            (3, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ö–æ–≤–∞–ª—å—á—É–∫ –ö.–†./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (5, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (6, '–ò—Å—Ç–æ—Ä–∏—è', '–ë–µ–ª—å—Å–∫–∏–π –°.–í.')
        ]
    },
    '10–∞': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ./–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (2, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ê—Ä—Ç—é—Ö –ú.–ü./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (3, '–•–∏–º–∏—è', '–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (4, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (5, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (6, '–ë–µ–ª. —è–∑—ã–∫', '–ë—Ä–µ–ª—å –Æ.–í./–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í./–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (2, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (3, '–•–∏–º–∏—è', '–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (4, '–ë–∏–æ–ª–æ–≥–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (5, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
            (6, '–ë–µ–ª. —è–∑—ã–∫(–ø—Ä–æ—Ñ)', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (2, '–î–ü/–ú–ü', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê./–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (3, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.'),
            (4, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ./–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í./–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (6, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (7, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞(–ø—Ä–æ—Ñ)', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í/–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (3, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (4, '–ò—Å—Ç–æ—Ä–∏—è', '–°–∏–≤—ã–π –ê.–í.'),
            (5, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (6, '–û–±—â–µ—Å—Ç–≤–æ–≤–µ–¥–µ–Ω–∏–µ', '–°–∏–≤—ã–π –ê.–í.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í./–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (2, '–ë–∏–æ–ª–æ–≥–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.'),
            (3, '–ë–µ–ª. —è–∑—ã–∫/–ú–∞—Ç–µ–º(–ø—Ä–æ—Ñ)', '–ë—Ä–µ–ª—å –Æ.–í./–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (4, '–ß–µ—Ä—á–µ–Ω–∏–µ', '–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (5, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ê—Ä—Ç—é—Ö –ú.–ü./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (6, '–ë–µ–ª. —è–∑—ã–∫(–ø—Ä–æ—Ñ)', '–ê–Ω–∏—Å–µ–Ω–∫–æ –°.–í.')
        ]
    },
    '10–±': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (2, '–ë–∏–æ–ª–æ–≥–∏—è/–•–∏–º–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (4, '–ê–Ω–≥–ª. —è–∑—ã–∫/–•–∏–º–∏—è', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (5, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú./–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (6, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í./–°–∏–≤—ã–π –ê.–í.'),
            (7, '–±–∏–æ–ª–æ–≥–∏—è/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê./–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (2, '–ë–∏–æ–ª–æ–≥–∏—è/–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (3, '–§–∏–∑–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (4, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫/–•–∏–º–∏—è', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (5, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú./–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ.'),
            (6, '–ë–∏–æ–ª–æ–≥–∏—è(–ø—Ä–æ—Ñ)', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (3, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (4, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í./–°–∏–≤—ã–π –ê.–í.'),
            (5, '–ê–Ω–≥–ª. —è–∑—ã–∫/–ò—Å—Ç–æ—Ä–∏—è', '–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê./–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (6, '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (7, '–ë–∏–æ–ª–æ–≥–∏—è/—Ö–∏–º–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (2, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ–µ–±–µ–¥–µ–≤—Å–∫–∞—è –ú.–ü.'),
            (3, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ–µ–æ–Ω–æ–≤–∞ –î.–ê.'),
            (4, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (6, '–î–ü/–ú–ü', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê./–°–º–æ–ª—å—Å–∫–∏–π –°.–ú.'),
            (7, '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫', '–ü—Ä–∏—Ö–æ–¥—å–∫–æ –ò.–ù.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–ß–µ—Ä—á–µ–Ω–∏–µ', '–ú–∏—Ö–∞—Å—ë–≤ –í.–ê.'),
            (2, '–ê–Ω–≥–ª. —è–∑—ã–∫/–ò—Å—Ç–æ—Ä–∏—è', '–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê./–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (3, '–§–∏–∑–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (4, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ù–∞–∑–∞—Ä–µ–Ω–∫–æ –¢.–ö.'),
            (5, '–ë–∏–æ–ª–æ–≥–∏—è/–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (6, '–û–±—â–µ—Å—Ç–≤–æ–≤–µ–¥–µ–Ω–∏–µ', '–°–∏–≤—ã–π –ê.–í.')
        ]
    },
    '11': {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
            (1, '–ë–∏–æ–ª–æ–≥–∏—è/–•–∏–º–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (2, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (3, '–û–±—â–µ—Å—Ç–≤–æ–≤–µ–¥–µ–Ω–∏–µ', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (4, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (5, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (6, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ./–Ø–≤–æ—à –°.–í.'),
            (7, '–ê–Ω–≥–ª. —è–∑/–†—É—Å. —è–∑', '–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê./–ü–∏–Ω—á—É–∫ –ê.–í.')
        ],
        '–í—Ç–æ—Ä–Ω–∏–∫': [
            (1, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ—É–∫—å—è–Ω–µ–Ω–∫–æ –õ.–ò.'),
            (2, '–ò—Å—Ç–æ—Ä–∏—è', '–ö–æ—Ä–æ–ª—ë–≤–∞ –ñ.–í.'),
            (3, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–í–µ—Ä–≥–µ–π—á–∏–∫ –í.–õ./–Ø–≤–æ—à –°.–í.'),
            (4, '–ê–Ω–≥–ª. —è–∑/–†—É—Å. —è–∑', '–•–æ—Ä–æ—à–∫–æ –¢.–ê./–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (5, '–ê–Ω–≥–ª. —è–∑/–†—É—Å. —è–∑', '–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê./–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (6, '–†—É—Å. —è–∑/–•–∏–º–∏—è', '–ü–∏–Ω—á—É–∫ –ê.–í./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.')
        ],
        '–°—Ä–µ–¥–∞': [
            (1, '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞', '–ì—É–¥ –Æ.–ü./–ü—Ä–∏—Ö–∞—á –ï.–í.'),
            (2, '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è', '–Æ–Ω–∞—Ö –¢.–í.'),
            (3, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (4, '–ë–∏–æ–ª–æ–≥–∏—è/–•–∏–º–∏—è', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (5, '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–õ—É–∫—å—è–Ω–µ–Ω–∫–æ –õ.–ò.'),
            (6, '–î–ü/–ú–ü', '–î–∞–Ω–∏–ª–µ–Ω–∫–æ –ê.–ê./–Ø–≤–æ—à –°.–í.')
        ],
        '–ß–µ—Ç–≤–µ—Ä–≥': [
            (1, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (2, '–ê—Å—Ç—Ä–æ–Ω–æ–º–∏—è', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (3, '–ë–µ–ª. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–õ—É–∫—å—è–Ω–µ–Ω–∫–æ –õ.–ò.'),
            (4, '–§–∏–∑–∏–∫–∞', '–°—Ç–∏—à–µ–Ω–æ–∫ –ù.–ò.'),
            (5, '–ë–∏–æ–ª–æ–≥–∏—è/–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (6, '–ê–Ω–≥–ª. —è–∑/–ë–∏–æ–ª–æ–≥–∏—è', '–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê./–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì.')
        ],
        '–ü—è—Ç–Ω–∏—Ü–∞': [
            (1, '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞', '–Ø–≤–æ—à –°.–í.'),
            (2, '–†—É—Å. –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (3, '–ê–Ω–≥–ª. —è–∑/–†—É—Å. —è–∑', '–•–æ—Ä–æ—à–∫–æ –¢.–ê./–ü–∏–Ω—á—É–∫ –ê.–í.'),
            (4, '–ë–∏–æ–ª–æ–≥–∏—è/–•–∏–º–∏—è', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì./–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.'),
            (5, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞ –õ.–í.'),
            (6, '–ë–∏–æ–ª–æ–≥–∏—è/–ê–Ω–≥–ª. —è–∑', '–ö–∞–Ω—É–Ω–æ–≤–∞ –í.–ì./–¢–∏—Ö–æ–Ω–µ–Ω–∫–æ –û.–ê.'),
            (7, '–•–∏–º–∏—è(–ø—Ä–æ—Ñ)', '–ö–æ—Ä–æ–ª—å—á—É–∫ –û.–ì.')
        ]
    }
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# ================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==================
def get_lesson_time(lesson_number):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è —É—Ä–æ–∫–∞ –ø–æ –µ–≥–æ –Ω–æ–º–µ—Ä—É."""
    lesson_times = {
        1: "08:00-08:45",
        2: "09:00-09:45",
        3: "10:00-10:45",
        4: "11:00-11:45",
        5: "12:00-12:45",
        6: "12:55-13:40",
        7: "14:00-14:45",
        8: "15:00-15:45",
        9: "16:00-16:45",
        10: "17:00-17:45"
    }
    return lesson_times.get(lesson_number, "??:??-??:??")

# ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...

def format_schedule_day(class_name, day, structured_lessons, target_date=None):
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å –∑–∞–º–µ–Ω–∞–º–∏."""
    if not structured_lessons:
        return "–ù–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ—Ç."

    structured_lessons.sort(key=lambda x: x[0])
    
    # –ü–æ–ª—É—á–∞–µ–º –∑–∞–º–µ–Ω—ã –¥–ª—è —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∏ –¥–∞—Ç—ã, –µ—Å–ª–∏ –¥–∞—Ç–∞ —É–∫–∞–∑–∞–Ω–∞
    substitutions = []
    if target_date:
        substitutions = db.get_substitutions_for_class_date(class_name, target_date)
    
    # –°–æ–∑–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä—å –∑–∞–º–µ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –Ω–æ–º–µ—Ä—É —É—Ä–æ–∫–∞
    sub_dict = {}
    for sub in substitutions:
        lesson_num = sub[3]  # lesson_number
        sub_dict[lesson_num] = {
            'old_subject': sub[4],
            'new_subject': sub[5],
            'old_teacher': sub[6],
            'new_teacher': sub[7]
        }

    result_lines = []
    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–Ω—è –∏ –∫–ª–∞—Å—Å–∞
    header = f"üìÖ <b>{day.upper()} - {class_name.upper()}</b>"
    result_lines.append(header)
    
    # –õ–∏–Ω–∏—è –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º - –¥–ª–∏–Ω–∞ —Ä–∞–≤–Ω–∞ –¥–ª–∏–Ω–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–±–µ–∑ HTML —Ç–µ–≥–æ–≤)
    header_length = len(day) + 3 + len(class_name)  # –¥–µ–Ω—å + " - " + –∫–ª–∞—Å—Å
    result_lines.append("‚îÄ" * header_length)

    for lesson_num, subject, teacher in structured_lessons:
        lesson_time = get_lesson_time(lesson_num)
        
        # –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —É—Ä–æ–∫–∞ –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
        if lesson_num <= 6:
            emoji = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£"][lesson_num - 1]
            lesson_str = f"{emoji}"
        else:
            lesson_str = f"{lesson_num}."
        
        # –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç: 1Ô∏è‚É£ 08:00-08:45‚û°Ô∏è–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞‚úÖ–Ø–≤–æ—à –°.–í.
        main_line = f"{lesson_str} <b>{lesson_time}</b>‚û°Ô∏è{subject}‚úÖ{teacher}"
        result_lines.append(main_line)
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–º–µ–Ω–∞ –Ω–∞ —ç—Ç–æ—Ç —É—Ä–æ–∫
        if lesson_num in sub_dict:
            sub = sub_dict[lesson_num]
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –ø—Ä–µ–¥–º–µ—Ç –∏ —É—á–∏—Ç–µ–ª—å —Å –∑–∞–º–µ–Ω–æ–π
            if (subject == sub['old_subject'] and teacher == sub['old_teacher']) or \
               (subject in sub['old_subject'] and teacher in sub['old_teacher']):
                result_lines.append(f"   ‚îî‚îÄ üîÑ <b>–ó–ê–ú–ï–ù–ê:</b> {sub['new_subject']}‚úÖ{sub['new_teacher']}")
            else:
                result_lines.append(f"   ‚îî‚îÄ üîÑ <b>–î–û–ü. –ó–ê–ú–ï–ù–ê:</b> {sub['new_subject']}‚úÖ{sub['new_teacher']}")

    return "\n".join(result_lines)


def format_weekly_schedule(class_name):
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ."""
    if class_name not in SCHEDULE_STRUCTURED:
        return f"–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–ª–∞—Å—Å–∞ {class_name} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ."
    
    result_lines = []
    result_lines.append(f"üìÖ <b>–†–ê–°–ü–ò–°–ê–ù–ò–ï –ù–ê –ù–ï–î–ï–õ–Æ - {class_name.upper()}</b>")
    result_lines.append("‚ïê" * (len(f"–†–ê–°–ü–ò–°–ê–ù–ò–ï –ù–ê –ù–ï–î–ï–õ–Æ - {class_name.upper()}") + 2))
    
    days_order = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞"]
    
    for day in days_order:
        if day in SCHEDULE_STRUCTURED[class_name]:
            lessons = SCHEDULE_STRUCTURED[class_name][day]
            if lessons:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É—Ä–æ–∫–∏ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å
                # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–Ω—è
                result_lines.append(f"\n<b>üìå {day.upper()}:</b>")
                
                # –õ–∏–Ω–∏—è –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –¥–Ω—è - –¥–ª–∏–Ω–∞ —Ä–∞–≤–Ω–∞ –¥–ª–∏–Ω–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
                day_length = len(day) + 1  # +1 –¥–ª—è –¥–≤–æ–µ—Ç–æ—á–∏—è
                result_lines.append("‚îÄ" * day_length)
                
                for lesson_num, subject, teacher in lessons:
                    lesson_time = get_lesson_time(lesson_num)
                    if lesson_num <= 6:
                        emoji = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£"][lesson_num - 1]
                        lesson_str = f"{emoji}"
                    else:
                        lesson_str = f"{lesson_num}."
                    
                    # –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç: 1Ô∏è‚É£ 08:00-08:45‚û°Ô∏è–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞‚úÖ–Ø–≤–æ—à –°.–í.
                    line = f"{lesson_str} <b>{lesson_time}</b>‚û°Ô∏è{subject}‚úÖ{teacher}"
                    result_lines.append(line)
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Å—É–±–±–æ—Ç—É, –µ—Å–ª–∏ –µ—Å—Ç—å —É—Ä–æ–∫–∏ –≤ —Å—É–±–±–æ—Ç—É
    if "–°—É–±–±–æ—Ç–∞" in SCHEDULE_STRUCTURED[class_name]:
        day = "–°—É–±–±–æ—Ç–∞"
        lessons = SCHEDULE_STRUCTURED[class_name][day]
        if lessons:
            result_lines.append(f"\n<b>üìå {day.upper()}:</b>")
            day_length = len(day) + 1  # +1 –¥–ª—è –¥–≤–æ–µ—Ç–æ—á–∏—è
            result_lines.append("‚îÄ" * day_length)
            
            for lesson_num, subject, teacher in lessons:
                lesson_time = get_lesson_time(lesson_num)
                if lesson_num <= 6:
                    emoji = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£"][lesson_num - 1]
                    lesson_str = f"{emoji}"
                else:
                    lesson_str = f"{lesson_num}."
                
                line = f"{lesson_str} <b>{lesson_time}</b>‚û°Ô∏è{subject}‚úÖ{teacher}"
                result_lines.append(line)
    
    return "\n".join(result_lines)

# ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...

def format_substitution(sub):
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∑–∞–º–µ–Ω—É –≤ –∫—Ä–∞—Å–∏–≤–æ–º –≤–∏–¥–µ."""
    if len(sub) >= 9:  # –¢–µ–ø–µ—Ä—å 9 –ø–æ–ª–µ–π —Å —É—á–µ—Ç–æ–º class_name
        return (f"<b>‚Ü™Ô∏è {sub[8]} –∫–ª–∞—Å—Å, {sub[3]} —É—Ä–æ–∫:</b>\n"
                f"   <code>{sub[4]}</code> <i>({sub[6]})</i>\n"
                f"   ‚Üí <code>{sub[5]}</code> <i>({sub[7]})</i>")
    return str(sub)

def get_all_teachers():
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —É—á–∏—Ç–µ–ª–µ–π –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è."""
    teachers = set()
    for class_name, days in SCHEDULE_STRUCTURED.items():
        for day, lessons in days.items():
            for lesson in lessons:
                if len(lesson) >= 3:
                    teacher_name = lesson[2]
                    if teacher_name:
                        teacher_list = [t.strip() for t in teacher_name.split('/')]
                        for teacher in teacher_list:
                            teacher_clean = re.sub(r'\s*\(.*\)', '', teacher)
                            if teacher_clean and teacher_clean not in ['', ' ']:
                                teachers.add(teacher_clean)
    return sorted(list(teachers))

def get_teacher_schedule(teacher_name):
    """–ü–æ–ª—É—á–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—á–∏—Ç–µ–ª—è –∏–∑ –æ–±—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã."""
    schedule = {}

    for class_name, days in SCHEDULE_STRUCTURED.items():
        for day, lessons in days.items():
            for lesson in lessons:
                if len(lesson) >= 3:
                    current_teacher = lesson[2]
                    teacher_list = [t.strip() for t in current_teacher.split('/')]
                    teacher_list_clean = [re.sub(r'\s*\(.*\)', '', t) for t in teacher_list]

                    if teacher_name in teacher_list_clean:
                        if day not in schedule:
                            schedule[day] = []

                        lesson_info = {
                            'class': class_name,
                            'number': lesson[0],
                            'subject': lesson[1],
                            'time': get_lesson_time(lesson[0]),
                            'full_teacher': current_teacher
                        }
                        schedule[day].append(lesson_info)

    for day in schedule:
        schedule[day].sort(key=lambda x: x['number'])

    return schedule

def format_teacher_schedule(teacher_name, schedule):
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—á–∏—Ç–µ–ª—è —Å —É—á–µ—Ç–æ–º –í–°–ï–• –∑–∞–º–µ–Ω."""
    # –ü–æ–ª—É—á–∞–µ–º –í–°–ï –∑–∞–º–µ–Ω—ã –¥–ª—è —ç—Ç–æ–≥–æ —É—á–∏—Ç–µ–ª—è –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π
    today = datetime.now().date()
    teacher_substitutions = {}
    
    # –ü–æ–ª—É—á–∞–µ–º –∑–∞–º–µ–Ω—ã –Ω–∞ 30 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥
    for i in range(30):
        target_date = today + timedelta(days=i)
        date_str = str(target_date)
        subs = db.get_substitutions_by_teacher_and_date(teacher_name, date_str)
        if subs:
            teacher_substitutions[date_str] = subs

    # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—á–∏—Ç–µ–ª–µ
    text = f"<b>üë®‚Äçüè´ {teacher_name}</b>\n\n"
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å)
    if schedule:
        total_lessons = sum(len(lessons) for lessons in schedule.values())
        classes = set()
        subjects = set()

        for day_lessons in schedule.values():
            for lesson in day_lessons:
                classes.add(lesson['class'])
                subjects.add(lesson['subject'])

        text += f"<b>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:</b>\n"
        text += f"‚Ä¢ –£—Ä–æ–∫–æ–≤ –≤ –Ω–µ–¥–µ–ª—é: <b>{total_lessons}</b>\n"
        text += f"‚Ä¢ –ö–ª–∞—Å—Å—ã: <b>{', '.join(sorted(classes))}</b>\n"
        text += f"‚Ä¢ –ü—Ä–µ–¥–º–µ—Ç—ã: <b>{', '.join(sorted(subjects))}</b>\n"
    else:
        text += "<i>‚ùå –ù–µ—Ç —É—Ä–æ–∫–æ–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏</i>\n\n"

    # –°—á–∏—Ç–∞–µ–º –í–°–ï –∑–∞–º–µ–Ω—ã
    total_subs = sum(len(subs) for subs in teacher_substitutions.values())
    if total_subs > 0:
        text += f"‚Ä¢ <b>‚ö†Ô∏è –í–°–ï–ì–û –∑–∞–º–µ–Ω: {total_subs}</b>\n"
    
    text += "\n" + "‚ïê" * 50 + "\n\n"

    # –ü–ï–†–í–û–ï: –û—Å–Ω–æ–≤–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é
    text += "<b>üìÖ –û–°–ù–û–í–ù–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï –ù–ê –ù–ï–î–ï–õ–Æ:</b>\n\n"
    
    days_order = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞"]
    has_main_schedule = False
    
    for day in days_order:
        if day in schedule and schedule[day]:
            has_main_schedule = True
            # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–ª–∏–Ω—É –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –≤ —Å–∏–º–≤–æ–ª–∞—Ö (–±–µ–∑ —É—á–µ—Ç–∞ —ç–º–æ–¥–∑–∏ –∏ —Ç–µ–≥–æ–≤)
            day_length = len(day) + 1  # +1 –¥–ª—è –¥–≤–æ–µ—Ç–æ—á–∏—è
            text += f"<b>{day.upper()}:</b>\n"
            text += "‚îÄ" * day_length + "\n"
            
            sorted_lessons = sorted(schedule[day], key=lambda x: x['number'])
            for lesson in sorted_lessons:
                if lesson['number'] <= 7:
                    emoji = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£"][lesson['number'] - 1]
                    lesson_marker = emoji
                else:
                    lesson_marker = f"{lesson['number']}."
                
                col1 = f"{lesson_marker} <b>{lesson['time']}</b>"
                col2 = f"<code>{lesson['class'].upper()}</code>‚û°Ô∏è{lesson['subject']}"
                
                teachers = lesson['full_teacher'].split('/')
                if len(teachers) > 1:
                    col2 += " <i>(—Å —Å–æ–≤–º.)</i>"
                
                text += f"{col1}   {col2}\n"
            text += "\n"
    
    if not has_main_schedule:
        text += "<i>–ù–µ—Ç —É—Ä–æ–∫–æ–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏</i>\n\n"
    
    # –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–º–µ–Ω–∞ –≤ —Å—É–±–±–æ—Ç—É (–¥–µ–Ω—å –Ω–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏), –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω–æ
    if "–°—É–±–±–æ—Ç–∞" in schedule and schedule["–°—É–±–±–æ—Ç–∞"]:
        has_main_schedule = True
        day = "–°—É–±–±–æ—Ç–∞"
        day_length = len(day) + 1  # +1 –¥–ª—è –¥–≤–æ–µ—Ç–æ—á–∏—è
        text += f"<b>{day.upper()}:</b>\n"
        text += "‚îÄ" * day_length + "\n"
        
        sorted_lessons = sorted(schedule[day], key=lambda x: x['number'])
        for lesson in sorted_lessons:
            if lesson['number'] <= 7:
                emoji = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£"][lesson['number'] - 1]
                lesson_marker = emoji
            else:
                lesson_marker = f"{lesson['number']}."
            
            col1 = f"{lesson_marker} <b>{lesson['time']}</b>"
            col2 = f"<code>{lesson['class'].upper()}</code>‚û°Ô∏è{lesson['subject']}"
            
            teachers = lesson['full_teacher'].split('/')
            if len(teachers) > 1:
                col2 += " <i>(—Å —Å–æ–≤–º.)</i>"
            
            text += f"{col1}   {col2}\n"
        text += "\n"
    
    text += "‚ïê" * 50 + "\n\n"

    # –í–¢–û–†–û–ï: –ó–∞–º–µ–Ω—ã –≤ –¥–Ω–∏ —Å —É—Ä–æ–∫–∞–º–∏
    if teacher_substitutions:
        text += "<b>üîÑ –ó–ê–ú–ï–ù–´ –í –î–ù–ò –° –£–†–û–ö–ê–ú–ò:</b>\n\n"
        
        # –°–æ–∑–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä—å –¥–∞—Ç –¥–ª—è –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π
        days_with_dates = {}
        current_date = today
        for i in range(30):
            day_index = current_date.weekday()
            if day_index < 6:  # –ü–Ω-–°–±
                day_name_ru = DAYS_OF_WEEK[day_index] if day_index < 5 else "–°—É–±–±–æ—Ç–∞"
                days_with_dates[day_name_ru] = days_with_dates.get(day_name_ru, [])
                days_with_dates[day_name_ru].append(str(current_date))
            current_date += timedelta(days=1)

        days_shown = set()
        found_substitutions = False
        
        for day in days_order:
            # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
            day_dates = days_with_dates.get(day, [])
            
            for date_str in day_dates[:7]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –±–ª–∏–∂–∞–π—à–∏–µ 7 –¥–∞—Ç —ç—Ç–æ–≥–æ –¥–Ω—è
                date_obj = datetime.strptime(date_str, "%Y-%m-%d").date()
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∑–∞–º–µ–Ω—ã –Ω–∞ —ç—Ç—É –¥–∞—Ç—É
                if date_str in teacher_substitutions:
                    day_subs = teacher_substitutions[date_str]
                    
                    # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–º–µ–Ω—ã –ø–æ —Ç–∏–ø—É
                    teacher_as_new = []  # –£—á–∏—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ –∑–∞–º–µ–Ω—É
                    teacher_as_old = []  # –£—á–∏—Ç–µ–ª—è –∑–∞–º–µ–Ω–∏–ª–∏
                    
                    for sub in day_subs:
                        if sub[7] == teacher_name:  # teacher_name - –Ω–æ–≤—ã–π —É—á–∏—Ç–µ–ª—å
                            teacher_as_new.append(sub)
                        elif sub[6] == teacher_name:  # teacher_name - —Å—Ç–∞—Ä—ã–π —É—á–∏—Ç–µ–ª—å
                            teacher_as_old.append(sub)
                    
                    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–Ω—å –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–º–µ–Ω—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º —É—á–∏—Ç–µ–ª–µ–º
                    if teacher_as_new or teacher_as_old:
                        found_substitutions = True
                        # –î–ª—è –¥–Ω–µ–π —Å –∑–∞–º–µ–Ω–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ –ª–æ–≥–∏–∫—É: –ª–∏–Ω–∏—è = –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–Ω—è
                        day_length = len(day) + 12  # —ç–º–æ–¥–∑–∏ + –ø—Ä–æ–±–µ–ª + –¥–∞—Ç–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ)
                        text += f"<b>üìÖ {day.upper()}</b> <i>({date_obj.strftime('%d.%m')})</i>\n"
                        text += "‚îÄ" * day_length + "\n"
                        
                        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–º–µ–Ω—ã, –≥–¥–µ —É—á–∏—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ –∑–∞–º–µ–Ω—É
                        if teacher_as_new:
                            for sub in teacher_as_new:
                                lesson_num = sub[3]
                                lesson_time = get_lesson_time(lesson_num)
                                
                                if lesson_num <= 7:
                                    emoji = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£"][lesson_num - 1]
                                    lesson_marker = emoji
                                else:
                                    lesson_marker = f"{lesson_num}."
                                
                                text += f"{lesson_marker} <b>{lesson_time}</b> <code>{sub[8]}</code> - {sub[5]}\n"
                                text += f"   üîÑ <b>–ó–ê–ú–ï–ù–ê:</b> –≤–º–µ—Å—Ç–æ {sub[6]} ({sub[4]})\n\n"
                        
                        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–º–µ–Ω—ã, –≥–¥–µ —É—á–∏—Ç–µ–ª—è –∑–∞–º–µ–Ω–∏–ª–∏
                        if teacher_as_old:
                            for sub in teacher_as_old:
                                lesson_num = sub[3]
                                lesson_time = get_lesson_time(lesson_num)
                                
                                if lesson_num <= 7:
                                    emoji = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£"][lesson_num - 1]
                                    lesson_marker = emoji
                                else:
                                    lesson_marker = f"{lesson_num}."
                                
                                text += f"{lesson_marker} <b>{lesson_time}</b> <code>{sub[8]}</code> - {sub[4]}\n"
                                text += f"   üîÑ <b>–ó–ê–ú–ï–ù–ï–ù:</b> {sub[7]} ({sub[5]})\n\n"
                        
                        days_shown.add(date_str)
        
        if not found_substitutions:
            text += "<i>–ù–∞ –±–ª–∏–∂–∞–π—à–∏–µ 7 –¥–Ω–µ–π –∑–∞–º–µ–Ω –≤ –¥–Ω–∏ —Å —É—Ä–æ–∫–∞–º–∏ –Ω–µ—Ç</i>\n\n"

        # –¢–†–ï–¢–¨–ï: –ó–∞–º–µ–Ω—ã –≤ –¥–Ω–∏ –±–µ–∑ —É—Ä–æ–∫–æ–≤ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω—ã)
        text += "\n<b>üîÑ –ó–ê–ú–ï–ù–´ –í –î–ù–ò –ë–ï–ó –£–†–û–ö–û–í:</b>\n\n"
        
        extra_subs_shown = False
        for date_str, subs in teacher_substitutions.items():
            if date_str in days_shown:
                continue  # –£–∂–µ –ø–æ–∫–∞–∑–∞–ª–∏ –≤—ã—à–µ
                
            date_obj = datetime.strptime(date_str, "%Y-%m-%d").date()
            day_index = date_obj.weekday()
            
            if day_index < 6:  # –ü–Ω-–°–±
                day_name = DAYS_OF_WEEK[day_index] if day_index < 5 else "–°—É–±–±–æ—Ç–∞"
                
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–º–µ–Ω—ã, –≥–¥–µ —É—á–∏—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ –∑–∞–º–µ–Ω—É
                teacher_as_new = [sub for sub in subs if sub[7] == teacher_name]
                if teacher_as_new:
                    extra_subs_shown = True
                    day_length = len(day_name) + 12  # —ç–º–æ–¥–∑–∏ + –ø—Ä–æ–±–µ–ª + –¥–∞—Ç–∞
                    text += f"<b>üìÖ {day_name}</b> <i>({date_obj.strftime('%d.%m')})</i>\n"
                    text += "‚îÄ" * day_length + "\n"
                    
                    for sub in teacher_as_new:
                        lesson_num = sub[3]
                        lesson_time = get_lesson_time(lesson_num)
                        
                        if lesson_num <= 7:
                            emoji = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£"][lesson_num - 1]
                            lesson_marker = emoji
                        else:
                            lesson_marker = f"{lesson_num}."
                        
                        text += f"  {lesson_marker} <b>{lesson_time}</b> <code>{sub[8]}</code> - {sub[5]}\n"
                        text += f"    <i>–≤–º–µ—Å—Ç–æ {sub[6]} ({sub[4]})</i>\n\n"
        
        if not extra_subs_shown:
            text += "<i>–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–º–µ–Ω –≤ –¥–Ω–∏ –±–µ–∑ —É—Ä–æ–∫–æ–≤</i>\n\n"
    
    else:
        text += "<b>üîÑ –ó–ê–ú–ï–ù–´:</b>\n\n"
        text += "<i>–ù–∞ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π –∑–∞–º–µ–Ω –Ω–µ—Ç</i>\n\n"
    
    text += "‚ïê" * 50 + "\n"
    text += f"<i>‚ÑπÔ∏è –ü–æ–∫–∞–∑–∞–Ω—ã —É—Ä–æ–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏ –∑–∞–º–µ–Ω—ã –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π</i>"
    
    return text

async def send_substitution_notification(context, teacher_name, substitution_data):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª—é –æ –Ω–æ–≤–æ–π –∑–∞–º–µ–Ω–µ."""
    teacher_id = TEACHER_IDS.get(teacher_name)

    if not teacher_id or teacher_id == 0:
        logger.warning(f"–£—á–∏—Ç–µ–ª—å {teacher_name} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–æ–≤–∞—Ä–µ –∏–ª–∏ ID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        return

    try:
        lesson_time = get_lesson_time(substitution_data['lesson'])

        notification_message = (
            f"<b>üîî –í–ê–ú –ù–ê–ó–ù–ê–ß–ï–ù–ê –ó–ê–ú–ï–ù–ê!</b>\n\n"
            f"<b>üìÖ –î–∞—Ç–∞:</b> {substitution_data['date']}\n"
            f"<b>üìÖ –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</b> {substitution_data['day']}\n"
            f"<b>üïê –í—Ä–µ–º—è —É—Ä–æ–∫–∞:</b> {lesson_time}\n"
            f"<b>üî¢ –ù–æ–º–µ—Ä —É—Ä–æ–∫–∞:</b> {substitution_data['lesson']}\n"
            f"<b>üè´ –ö–ª–∞—Å—Å:</b> {substitution_data['class_name']}\n"
            f"<b>üìö –ó–∞–º–µ–Ω–∞:</b> {substitution_data['old_subject']} ({substitution_data['old_teacher']}) ‚Üí "
            f"{substitution_data['new_subject']} (–í—ã)\n\n"
            f"<i>–ó–∞–º–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.</i>"
        )

        await context.bot.send_message(
            chat_id=teacher_id,
            text=notification_message,
            parse_mode='HTML'
        )

        logger.info(f"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–º–µ–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—á–∏—Ç–µ–ª—é {teacher_name} (ID: {teacher_id})")

    except Exception as e:
        error_msg = str(e)
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—á–∏—Ç–µ–ª—é {teacher_name}: {error_msg}")

# ================== –ö–û–ú–ê–ù–î–ê /start ==================
async def start(update: Update, context: CallbackContext):
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞."""
    keyboard = [
        [InlineKeyboardButton("üë®‚Äçüè´ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—á–∏—Ç–µ–ª–µ–π", callback_data='menu_teacher')],
        [InlineKeyboardButton("üïê –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤", callback_data='menu_bells')],
        [InlineKeyboardButton("üìö –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤", callback_data='menu_schedule')],
        [InlineKeyboardButton("üîÑ –ó–∞–º–µ–Ω—ã", callback_data='menu_substitutions')],
        [InlineKeyboardButton("üîç –ü–æ–∏—Å–∫ —É—á–∏—Ç–µ–ª—è", callback_data='menu_search_teacher')],
        [InlineKeyboardButton("üÜò –ü–æ–º–æ—â—å", callback_data='menu_help')],
        [InlineKeyboardButton("üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", callback_data='admin_panel')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    try:
        await update.message.reply_text(
            'üè´ *–®–∫–æ–ª—å–Ω—ã–π –±–æ—Ç*\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:',
            reply_markup=reply_markup,
            parse_mode='Markdown'
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ start: {e}")
        await update.message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")

# ================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–ù–û–ü–ö–ò –°–¢–ê–†–¢ ==================
def add_start_button(keyboard=None):
    """–î–æ–±–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É '–°—Ç–∞—Ä—Ç' –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É."""
    if keyboard is None:
        keyboard = []
    keyboard.append([InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])
    return keyboard

# ================== –û–ë–†–ê–ë–û–¢–ß–ò–ö –í–°–ï–• –ö–ù–û–ü–û–ö ==================
async def button_handler(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ inline-–∫–Ω–æ–ø–∫–∏."""
    query = update.callback_query

    # –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞ context.user_data
    if not isinstance(context.user_data, dict):
        context.user_data = {}

    try:
        await query.answer()
    except TimedOut:
        logger.warning("Timeout –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –Ω–∞ callback query")
        return
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –Ω–∞ callback: {e}")
        return

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ–Ω —á–µ—Ä–µ–∑ –º–µ–Ω—é
    if 'adding_substitution' in context.user_data:
        try:
            await handle_adding_substitution(query, context)
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–º–µ–Ω—ã: {e}")
            await query.edit_message_text(
                f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)[:100]}",
                parse_mode='HTML'
            )
        return

    # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    if query.data == 'back_to_main':
        await show_main_menu(query)
        return

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
    try:
        if query.data == 'menu_teacher':
            await show_teacher_menu(query, context)

        elif query.data.startswith('teacher_'):
            await show_teacher_schedule(query, context)

        elif query.data == 'menu_search_teacher':
            await query.edit_message_text(
                "<b>üîç –ü–û–ò–°–ö –£–ß–ò–¢–ï–õ–Ø</b>\n\n"
                "–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏–ª–∏ —á–∞—Å—Ç—å —Ñ–∞–º–∏–ª–∏–∏ —É—á–∏—Ç–µ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞:\n\n"
                "<i>–ü—Ä–∏–º–µ—Ä: '–ö–æ—Ä–æ—Ç—á–∏–∫–æ–≤–∞' –∏–ª–∏ '–ì—É–¥'</i>",
                parse_mode='HTML'
            )
            context.user_data['searching_teacher'] = True

        elif query.data == 'menu_bells':
            await show_bells_schedule(query)

        elif query.data == 'menu_schedule':
            await show_class_selection(query)

        elif query.data.startswith('class_'):
            await show_day_selection_for_class(query, context)

        elif query.data.startswith('schedule_'):
            await show_daily_schedule(query, context)

        elif query.data.startswith('weekly_'):
            await show_weekly_schedule(query, context)

        elif query.data == 'menu_substitutions':
            await show_substitutions_menu(query)

        elif query.data in ['subs_yesterday', 'subs_today', 'subs_tomorrow']:
            await show_substitutions_for_date(query)

        elif query.data == 'subs_all':
            await show_all_substitutions(query)

        elif query.data == 'menu_help':
            await show_help(query)

        elif query.data == 'admin_panel':
            await show_admin_panel(query)

        elif query.data == 'admin_add_sub':
            await start_adding_substitution(query, context)

        elif query.data == 'admin_view_subs':
            await show_admin_substitutions(query)

        elif query.data == 'admin_delete_sub':
            await request_substitution_deletion(query)

        elif query.data == 'admin_clear_subs':
            await confirm_clear_substitutions(query)

        elif query.data == 'admin_clear_confirm':
            await clear_all_substitutions(query)

        elif query.data.startswith('teacher_search_'):
            await show_searched_teacher_schedule(query, context)

    except TimedOut:
        logger.error("Timeout –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–Ω–æ–ø–∫–∏")
        await query.edit_message_text(
            "‚è≥ –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
            parse_mode='HTML'
        )
    except NetworkError as e:
        logger.error(f"–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: {e}")
        await query.edit_message_text(
            "üåê –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
            parse_mode='HTML'
        )
    except Exception as e:
        logger.error(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ button_handler: {e}")
        await query.edit_message_text(
            f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)[:100]}",
            parse_mode='HTML'
        )

async def show_main_menu(query):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é."""
    keyboard = [
        [InlineKeyboardButton("üë®‚Äçüè´ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—á–∏—Ç–µ–ª–µ–π", callback_data='menu_teacher')],
        [InlineKeyboardButton("üïê –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤", callback_data='menu_bells')],
        [InlineKeyboardButton("üìö –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤", callback_data='menu_schedule')],
        [InlineKeyboardButton("üîÑ –ó–∞–º–µ–Ω—ã", callback_data='menu_substitutions')],
        [InlineKeyboardButton("üîç –ü–æ–∏—Å–∫ —É—á–∏—Ç–µ–ª—è", callback_data='menu_search_teacher')],
        [InlineKeyboardButton("üÜò –ü–æ–º–æ—â—å", callback_data='menu_help')],
        [InlineKeyboardButton("üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", callback_data='admin_panel')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(
        '<b>üè´ –®–∫–æ–ª—å–Ω—ã–π –±–æ—Ç</b>\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:',
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_teacher_menu(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —É—á–∏—Ç–µ–ª–µ–π."""
    real_teachers = get_all_teachers()

    teachers_per_row = 2
    keyboard = []
    row = []

    for i, teacher in enumerate(real_teachers):
        button_text = teacher
        if len(teacher) > 20:
            button_text = teacher[:18] + "..."

        row.append(InlineKeyboardButton(button_text, callback_data=f'teacher_{i}'))

        if len(row) >= teachers_per_row:
            keyboard.append(row)
            row = []

    if row:
        keyboard.append(row)

    context.user_data['teachers_list'] = real_teachers
    keyboard = add_start_button(keyboard)
    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(
        "<b>üë®‚Äçüè´ –†–ê–°–ü–ò–°–ê–ù–ò–ï –£–ß–ò–¢–ï–õ–ï–ô</b>\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∏—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é:",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_teacher_schedule(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—á–∏—Ç–µ–ª—è."""
    try:
        parts = query.data.split('_')

        if len(parts) >= 3 and parts[1] == 'search':
            teacher_index = int(parts[2])
            teachers_list = context.user_data.get('found_teachers', [])
        elif len(parts) >= 2:
            teacher_index = int(parts[1])
            teachers_list = context.user_data.get('teachers_list', [])
        else:
            raise ValueError("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç callback_data")

    except (ValueError, IndexError) as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback_data: {query.data}, –æ—à–∏–±–∫–∞: {e}")
        keyboard = add_start_button()
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text(
            "<b>‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞.</b>\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –º–µ–Ω—é.",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )
        return

    if not teachers_list or teacher_index >= len(teachers_list):
        keyboard = add_start_button()
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text(
            "<b>‚ùå –û—à–∏–±–∫–∞: —Å–ø–∏—Å–æ–∫ —É—á–∏—Ç–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω.</b>",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )
        return

    teacher_name = teachers_list[teacher_index]
    teacher_schedule = get_teacher_schedule(teacher_name)
    schedule_text = format_teacher_schedule(teacher_name, teacher_schedule)

    keyboard = [
        [InlineKeyboardButton("‚Ü©Ô∏è –ö —Å–ø–∏—Å–∫—É —É—á–∏—Ç–µ–ª–µ–π", callback_data='menu_teacher')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(
        schedule_text,
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_bells_schedule(query):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤."""
    keyboard = add_start_button()
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(BELLS_SCHEDULE_HTML, reply_markup=reply_markup, parse_mode='HTML')

async def show_class_selection(query):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞."""
    keyboard = [
        [InlineKeyboardButton("5–ê", callback_data='class_5–∞'), InlineKeyboardButton("5–ë", callback_data='class_5–±')],
        [InlineKeyboardButton("5–í", callback_data='class_5–≤'), InlineKeyboardButton("6–ê", callback_data='class_6–∞')],
        [InlineKeyboardButton("6–ë", callback_data='class_6–±'), InlineKeyboardButton("6–í", callback_data='class_6–≤')],
        [InlineKeyboardButton("7–ê", callback_data='class_7–∞'), InlineKeyboardButton("7–ë", callback_data='class_7–±')],
        [InlineKeyboardButton("7–í", callback_data='class_7–≤'), InlineKeyboardButton("8–ê", callback_data='class_8–∞')],
        [InlineKeyboardButton("8–ë", callback_data='class_8–±'), InlineKeyboardButton("9–ê", callback_data='class_9–∞')],
        [InlineKeyboardButton("9–ë", callback_data='class_9–±'), InlineKeyboardButton("10–ê", callback_data='class_10–∞')],
        [InlineKeyboardButton("10–ë", callback_data='class_10–±'), InlineKeyboardButton("11", callback_data='class_11')]
    ]
    keyboard = add_start_button(keyboard)
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(
        "<b>üìö –†–ê–°–ü–ò–°–ê–ù–ò–ï –£–†–û–ö–û–í</b>\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å:",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_day_selection_for_class(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –¥–ª—è –∫–ª–∞—Å—Å–∞."""
    class_name = query.data.replace('class_', '')
    context.user_data['selected_class'] = class_name

    keyboard = []
    for day in DAYS_OF_WEEK[:5]:
        keyboard.append([InlineKeyboardButton(day, callback_data=f'schedule_{day.lower()}')])
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é"
    keyboard.append([InlineKeyboardButton("üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é", callback_data=f'weekly_{class_name}')])
    keyboard.append([InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –∫–ª–∞—Å—Å–∞–º", callback_data='menu_schedule')])
    
    keyboard = add_start_button(keyboard)
    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(
        f"<b>üìö –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è {class_name.upper()}</b>\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é:",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_daily_schedule(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å."""
    day = query.data.replace('schedule_', '').capitalize()
    class_name = context.user_data.get('selected_class', '')

    # –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–º–µ–Ω
    today = datetime.now().date()
    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –≤ –¥–∞—Ç—É (—É–ø—Ä–æ—â–µ–Ω–Ω–æ - —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —ç—Ç–æ –±–ª–∏–∂–∞–π—à–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –¥–µ–Ω—å)
    day_mapping = {
        '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': 0,
        '–í—Ç–æ—Ä–Ω–∏–∫': 1,
        '–°—Ä–µ–¥–∞': 2,
        '–ß–µ—Ç–≤–µ—Ä–≥': 3,
        '–ü—è—Ç–Ω–∏—Ü–∞': 4,
        '–°—É–±–±–æ—Ç–∞': 5
    }
    
    target_date = None
    if day in day_mapping:
        days_ahead = day_mapping[day] - today.weekday()
        if days_ahead < 0:
            days_ahead += 7
        target_date = today + timedelta(days=days_ahead)
        target_date_str = target_date.strftime('%Y-%m-%d')
    else:
        target_date_str = None

    if class_name and class_name in SCHEDULE_STRUCTURED and day in SCHEDULE_STRUCTURED[class_name]:
        structured_lessons = SCHEDULE_STRUCTURED[class_name][day]
        schedule_text = format_schedule_day(class_name, day, structured_lessons, target_date_str)
    else:
        schedule_text = f"–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–ª–∞—Å—Å–∞ {class_name} –Ω–∞ {day} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ."

    keyboard = [
        [InlineKeyboardButton("üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é", callback_data=f'weekly_{class_name}')],
        [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –¥–Ω—è–º", callback_data=f'class_{class_name}')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(
        schedule_text,
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_weekly_schedule(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é."""
    class_name = query.data.replace('weekly_', '')
    
    schedule_text = format_weekly_schedule(class_name)

    keyboard = [
        [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –¥–Ω—è", callback_data=f'class_{class_name}')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(
        schedule_text,
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_substitutions_menu(query):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –∑–∞–º–µ–Ω."""
    keyboard = [
        [InlineKeyboardButton("üîÑ –í—á–µ—Ä–∞", callback_data='subs_yesterday')],
        [InlineKeyboardButton("üîÑ –°–µ–≥–æ–¥–Ω—è", callback_data='subs_today')],
        [InlineKeyboardButton("üîÑ –ó–∞–≤—Ç—Ä–∞", callback_data='subs_tomorrow')],
        [InlineKeyboardButton("üìã –í—Å–µ –∑–∞–º–µ–Ω—ã", callback_data='subs_all')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(
        "<b>üîÑ –ó–ê–ú–ï–ù–´ –£–†–û–ö–û–í</b>\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å:",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_substitutions_for_date(query):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–º–µ–Ω—ã –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É."""
    today = datetime.now().date()
    if query.data == 'subs_yesterday':
        target_date = today - timedelta(days=1)
    elif query.data == 'subs_today':
        target_date = today
    else:
        target_date = today + timedelta(days=1)

    subs = db.get_substitutions_for_date(str(target_date))
    if subs:
        text = f"<b>üîÑ –ó–∞–º–µ–Ω—ã –Ω–∞ {target_date.strftime('%d.%m.%Y')}:</b>\n\n"
        for sub in subs:
            text += format_substitution(sub) + "\n\n"
    else:
        text = f"<b>–ù–∞ {target_date.strftime('%d.%m.%Y')} –∑–∞–º–µ–Ω –Ω–µ—Ç.</b>"

    keyboard = [
        [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –∑–∞–º–µ–Ω–∞–º", callback_data='menu_substitutions')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(text, reply_markup=reply_markup, parse_mode='HTML')

async def show_all_substitutions(query):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–º–µ–Ω—ã."""
    subs = db.get_all_substitutions()
    if subs:
        text = "<b>üìã –í–°–ï –ó–ê–ú–ï–ù–´:</b>\n\n"
        current_date = None
        for sub in subs:
            if sub[1] != current_date:
                current_date = sub[1]
                text += f"\n<b>üìÖ {current_date}:</b>\n"
            text += format_substitution(sub) + "\n\n"
    else:
        text = "<b>–ó–∞–º–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</b>"

    if len(text) > 4000:
        text = text[:3900] + "\n\n... (—Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–µ–∑–∞–Ω–æ)"

    keyboard = [
        [InlineKeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –∑–∞–º–µ–Ω–∞–º", callback_data='menu_substitutions')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(text, reply_markup=reply_markup, parse_mode='HTML')

async def show_help(query):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É."""
    help_text = """
<b>üÜò –ü–û–ú–û–©–¨ –ò –ü–û–î–î–ï–†–ñ–ö–ê</b>

–ï—Å–ª–∏ –≤—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –æ—à–∏–±–∫—É –≤ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞ –∏–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å:

<b>üë®‚Äçüíº –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</b>
‚Ä¢ <b>–§–ò–û:</b> –ì—É–¥ –Æ—Ä–∏–π –ü–µ—Ç—Ä–æ–≤–∏—á(@Yury_hud)
‚Ä¢ <b>üìß Email:</b> uragud.2020@gmail.com
‚Ä¢ <b>‚òéÔ∏è –¢–µ–ª–µ—Ñ–æ–Ω:</b> +375336957183

<b>üïê –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</b>
–ü–Ω-–ü—Ç: 9:00-18:00
–°–±,–í—Å: –≤—ã—Ö–æ–¥–Ω–æ–π

<b>–î–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–æ–º–æ—â–∏ —É–∫–∞–∂–∏—Ç–µ:</b>
1. –í–∞—à–µ –∏–º—è –∏ –∫–ª–∞—Å—Å
2. –í—Ä–µ–º—è –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–∫–∏
3. –°–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–æ–±–ª–µ–º—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
    """
    keyboard = add_start_button()
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(help_text, reply_markup=reply_markup, parse_mode='HTML')

async def show_admin_panel(query):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å."""
    if query.from_user.id not in ADMIN_IDS:
        await query.edit_message_text("<b>‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω!</b>", parse_mode='HTML')
        return

    keyboard = [
        [InlineKeyboardButton("‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ–Ω—É", callback_data='admin_add_sub')],
        [InlineKeyboardButton("üìã –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–º–µ–Ω—ã", callback_data='admin_view_subs')],
        [InlineKeyboardButton("üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ–Ω—É", callback_data='admin_delete_sub')],
        [InlineKeyboardButton("üßπ –û—á–∏—Å—Ç–∫–∞ –∑–∞–º–µ–Ω", callback_data='admin_clear_subs')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(
        "<b>üëë –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨</b>\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def start_adding_substitution(query, context):
    """–ù–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ–Ω—ã."""
    if query.from_user.id not in ADMIN_IDS:
        return

    context.user_data['adding_substitution'] = True
    context.user_data['step'] = 'date'
    await show_date_selection(query, context)

async def show_admin_substitutions(query):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–º–µ–Ω—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."""
    if query.from_user.id not in ADMIN_IDS:
        return

    subs = db.get_all_substitutions()
    if subs:
        text = "<b>üìã –í–°–ï –ó–ê–ú–ï–ù–´ –í –ë–ê–ó–ï:</b>\n\n"
        for sub in subs:
            text += f"<b>ID:{sub[0]}</b> | {sub[1]} ({sub[2]}) | –ö–ª–∞—Å—Å: {sub[8]}\n"
            text += format_substitution(sub) + "\n\n"
    else:
        text = "<b>–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–º–µ–Ω –Ω–µ—Ç.</b>"

    if len(text) > 4000:
        text = text[:3900] + "\n\n... (—Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–µ–∑–∞–Ω–æ)"

    keyboard = [
        [InlineKeyboardButton("‚Ü©Ô∏è –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", callback_data='admin_panel')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(text, reply_markup=reply_markup, parse_mode='HTML')

async def request_substitution_deletion(query):
    """–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç ID –∑–∞–º–µ–Ω—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è."""
    if query.from_user.id not in ADMIN_IDS:
        return

    await query.edit_message_text(
        "<b>üóëÔ∏è –£–î–ê–õ–ï–ù–ò–ï –ó–ê–ú–ï–ù–´</b>\n\n"
        "–í–≤–µ–¥–∏—Ç–µ <b>ID –∑–∞–º–µ–Ω—ã</b> –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (–ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ ID –≤ —Å–ø–∏—Å–∫–µ –≤—Å–µ—Ö –∑–∞–º–µ–Ω):",
        parse_mode='HTML'
    )

async def confirm_clear_substitutions(query):
    """–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –∑–∞–º–µ–Ω."""
    if query.from_user.id not in ADMIN_IDS:
        return

    subs = db.get_all_substitutions()
    sub_count = len(subs) if subs else 0

    keyboard = [
        [
            InlineKeyboardButton("‚úÖ –î–∞, —É–¥–∞–ª–∏—Ç—å –≤—Å–µ", callback_data='admin_clear_confirm'),
            InlineKeyboardButton("‚ùå –ù–µ—Ç, –æ—Ç–º–µ–Ω–∏—Ç—å", callback_data='admin_panel')
        ],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(
        f"<b>‚ö†Ô∏è –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –û–ß–ò–°–¢–ö–ò –ó–ê–ú–ï–ù</b>\n\n"
        f"–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –∑–∞–º–µ–Ω—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö?\n\n"
        f"<b>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>\n"
        f"‚Ä¢ –í—Å–µ–≥–æ –∑–∞–º–µ–Ω –≤ –±–∞–∑–µ: <b>{sub_count}</b>\n\n"
        f"<b>‚ö†Ô∏è –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!</b>\n"
        f"–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–º–µ–Ω–∞—Ö –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def clear_all_substitutions(query):
    """–û—á–∏—â–∞–µ—Ç –≤—Å–µ –∑–∞–º–µ–Ω—ã."""
    if query.from_user.id not in ADMIN_IDS:
        return

    subs_before = db.get_all_substitutions()
    sub_count = len(subs_before) if subs_before else 0

    try:
        db.clear_all_substitutions()

        keyboard = [
            [InlineKeyboardButton("‚Ü©Ô∏è –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", callback_data='admin_panel')],
            [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            f"<b>‚úÖ –û–ß–ò–°–¢–ö–ê –ó–ê–ú–ï–ù –í–´–ü–û–õ–ù–ï–ù–ê</b>\n\n"
            f"–£–¥–∞–ª–µ–Ω–æ –∑–∞–º–µ–Ω: <b>{sub_count}</b>\n"
            f"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–º–µ–Ω —Ç–µ–ø–µ—Ä—å –ø—É—Å—Ç–∞.",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

        logger.info(f"–ê–¥–º–∏–Ω {query.from_user.id} –æ—á–∏—Å—Ç–∏–ª –≤—Å–µ –∑–∞–º–µ–Ω—ã. –£–¥–∞–ª–µ–Ω–æ: {sub_count}")

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∑–∞–º–µ–Ω: {e}")

        keyboard = [
            [InlineKeyboardButton("‚Ü©Ô∏è –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", callback_data='admin_panel')],
            [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            f"<b>‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –û–ß–ò–°–¢–ö–ï</b>\n\n"
            f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∑–∞–º–µ–Ω.\n"
            f"–û—à–∏–±–∫–∞: {str(e)[:100]}",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

async def show_searched_teacher_schedule(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —É—á–∏—Ç–µ–ª—è."""
    teacher_index = int(query.data.split('_')[2])
    found_teachers = context.user_data.get('found_teachers', [])

    if not found_teachers or teacher_index >= len(found_teachers):
        keyboard = add_start_button()
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text(
            "<b>‚ùå –û—à–∏–±–∫–∞: —Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —É—á–∏—Ç–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω.</b>",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )
        return

    teacher_name = found_teachers[teacher_index]
    teacher_schedule = get_teacher_schedule(teacher_name)
    schedule_text = format_teacher_schedule(teacher_name, teacher_schedule)

    keyboard = [
        [InlineKeyboardButton("üîç –ù–æ–≤—ã–π –ø–æ–∏—Å–∫", callback_data='menu_search_teacher')],
        [InlineKeyboardButton("üë®‚Äçüè´ –í—Å–µ —É—á–∏—Ç–µ–ª—è", callback_data='menu_teacher')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(
        schedule_text,
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

# ================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ó–ê–ú–ï–ù –ß–ï–†–ï–ó –ú–ï–ù–Æ ==================
async def handle_adding_substitution(query, context):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —à–∞–≥–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ–Ω—ã —á–µ—Ä–µ–∑ –º–µ–Ω—é."""
    step = context.user_data.get('step')

    if query.data == 'cancel_adding':
        context.user_data.clear()
        keyboard = add_start_button()
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text(
            "<b>‚ùå –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ–Ω—ã –æ—Ç–º–µ–Ω–µ–Ω–æ.</b>",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )
        return

    if step == 'date':
        if query.data.startswith('date_'):
            date_str = query.data.split('_')[1]
            context.user_data['date'] = date_str
            context.user_data['step'] = 'day'
            await show_day_selection(query, context)

    elif step == 'day':
        if query.data.startswith('day_'):
            day = query.data.split('_', 1)[1]
            context.user_data['day'] = day
            context.user_data['step'] = 'class'
            await show_class_selection_for_substitution(query, context)

    elif step == 'class':
        if query.data.startswith('sub_class_'):
            class_name = query.data.split('_', 2)[2]
            context.user_data['class_name'] = class_name
            context.user_data['step'] = 'lesson'
            await show_lesson_selection(query, context)

    elif step == 'lesson':
        if query.data.startswith('lesson_'):
            lesson_num = int(query.data.split('_')[1])
            context.user_data['lesson'] = lesson_num
            context.user_data['step'] = 'old_subject'
            await show_subject_selection(query, context, is_old=True)

    elif step == 'old_subject':
        if query.data.startswith('subject_'):
            old_subject = query.data.split('_', 1)[1]
            context.user_data['old_subject'] = old_subject
            context.user_data['step'] = 'new_subject'
            await show_subject_selection(query, context, is_old=False)

    elif step == 'new_subject':
        if query.data.startswith('subject_'):
            new_subject = query.data.split('_', 1)[1]
            context.user_data['new_subject'] = new_subject
            context.user_data['step'] = 'old_teacher'
            await show_teacher_selection(query, context, is_old=True)

    elif step == 'old_teacher':
        if query.data.startswith('teacher_'):
            old_teacher = query.data.split('_', 1)[1]
            context.user_data['old_teacher'] = old_teacher
            context.user_data['step'] = 'new_teacher'
            await show_teacher_selection(query, context, is_old=False)

    elif step == 'new_teacher':
        if query.data.startswith('teacher_'):
            new_teacher = query.data.split('_', 1)[1]
            context.user_data['new_teacher'] = new_teacher
            await save_substitution(query, context)

async def show_date_selection(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –¥–∞—Ç—ã."""
    today = datetime.now().date()
    dates = []
    for i in range(7):
        current_date = today + timedelta(days=i)
        dates.append(current_date)

    keyboard = []
    row = []
    for i, date in enumerate(dates):
        date_str = date.strftime('%d.%m.%Y')
        day_of_week = date.strftime('%A')
        day_short = {
            'Monday': '–ø–Ω', 'Tuesday': '–≤—Ç', 'Wednesday': '—Å—Ä',
            'Thursday': '—á—Ç', 'Friday': '–ø—Ç', 'Saturday': '—Å–±', 'Sunday': '–≤—Å'
        }.get(day_of_week, day_of_week)
        button_text = f"{date_str} ({day_short})"
        callback_data = f'date_{date.strftime("%Y-%m-%d")}'
        row.append(InlineKeyboardButton(button_text, callback_data=callback_data))
        if len(row) == 2 or i == len(dates) - 1:
            keyboard.append(row)
            row = []

    keyboard.append([InlineKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞", callback_data='cancel_adding')])
    keyboard.append([InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])
    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(
        "<b>‚ûï –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ú–ï–ù–´</b>\n\n"
        "<b>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</b>",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_day_selection(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –¥–Ω—è –Ω–µ–¥–µ–ª–∏."""
    keyboard = []
    row = []
    for i, day in enumerate(DAYS_OF_WEEK):
        button_text = day
        callback_data = f'day_{day}'
        row.append(InlineKeyboardButton(button_text, callback_data=callback_data))
        if len(row) == 2:
            keyboard.append(row)
            row = []
    if row:
        keyboard.append(row)

    keyboard.append([
        InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_to_date'),
        InlineKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞", callback_data='cancel_adding')
    ])
    keyboard.append([InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(
        "<b>‚ûï –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ú–ï–ù–´</b>\n\n"
        f"<b>üìÖ –î–∞—Ç–∞:</b> {context.user_data['date']}\n"
        "<b>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</b>",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_class_selection_for_substitution(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∫–ª–∞—Å—Å–∞ –¥–ª—è –∑–∞–º–µ–Ω—ã."""
    keyboard = []
    row = []
    for i, class_name in enumerate(ALL_CLASSES):
        button_text = class_name.upper()
        callback_data = f'sub_class_{class_name}'
        row.append(InlineKeyboardButton(button_text, callback_data=callback_data))
        if len(row) == 3:
            keyboard.append(row)
            row = []
    if row:
        keyboard.append(row)

    keyboard.append([
        InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_to_day'),
        InlineKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞", callback_data='cancel_adding')
    ])
    keyboard.append([InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(
        "<b>‚ûï –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ú–ï–ù–´</b>\n\n"
        f"<b>üìÖ –î–∞—Ç–∞:</b> {context.user_data['date']}\n"
        f"<b>üìÖ –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</b> {context.user_data.get('day', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        "<b>üè´ –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å:</b>",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_lesson_selection(query, context):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —É—Ä–æ–∫–∞."""
    keyboard = []
    row = []
    for i in range(1, 8):
        button_text = f"{i} —É—Ä–æ–∫"
        callback_data = f'lesson_{i}'
        row.append(InlineKeyboardButton(button_text, callback_data=callback_data))
        if len(row) == 3:
            keyboard.append(row)
            row = []
    if row:
        keyboard.append(row)

    keyboard.append([
        InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_to_class'),
        InlineKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞", callback_data='cancel_adding')
    ])
    keyboard.append([InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(
        "<b>‚ûï –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ú–ï–ù–´</b>\n\n"
        f"<b>üìÖ –î–∞—Ç–∞:</b> {context.user_data.get('date', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üìÖ –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</b> {context.user_data.get('day', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üè´ –ö–ª–∞—Å—Å:</b> {context.user_data.get('class_name', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        "<b>üî¢ –í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞:</b>",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_subject_selection(query, context, is_old=True):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞."""
    subject_type = "—Å—Ç–∞—Ä–æ–≥–æ" if is_old else "–Ω–æ–≤–æ–≥–æ"
    keyboard = []
    row = []
    for subject in SUBJECTS:
        button_text = subject
        callback_subject = subject.replace(' ', '_')
        callback_data = f'subject_{callback_subject}'
        row.append(InlineKeyboardButton(button_text, callback_data=callback_data))
        if len(row) == 2:
            keyboard.append(row)
            row = []
    if row:
        keyboard.append(row)

    back_callback = 'back_to_lesson' if is_old else 'back_to_old_subject'
    keyboard.append([
        InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data=back_callback),
        InlineKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞", callback_data='cancel_adding')
    ])
    keyboard.append([InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    reply_markup = InlineKeyboardMarkup(keyboard)

    text = (
        f"<b>‚ûï –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ú–ï–ù–´</b>\n\n"
        f"<b>üìÖ –î–∞—Ç–∞:</b> {context.user_data.get('date', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üìÖ –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</b> {context.user_data.get('day', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üè´ –ö–ª–∞—Å—Å:</b> {context.user_data.get('class_name', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üî¢ –£—Ä–æ–∫:</b> {context.user_data.get('lesson', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üìö –í—ã–±–µ—Ä–∏—Ç–µ {subject_type} –ø—Ä–µ–¥–º–µ—Ç:</b>"
    )

    await query.edit_message_text(
        text,
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def show_teacher_selection(query, context, is_old=True):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —É—á–∏—Ç–µ–ª—è."""
    teachers = list(TEACHER_IDS.keys())

    keyboard = []
    row = []
    for teacher in teachers:
        button_text = teacher
        callback_data = f'teacher_{teacher}'
        row.append(InlineKeyboardButton(button_text, callback_data=callback_data))
        if len(row) == 2:
            keyboard.append(row)
            row = []
    if row:
        keyboard.append(row)

    if is_old:
        back_callback = 'back_to_new_subject'
    else:
        back_callback = 'back_to_old_teacher'

    keyboard.append([
        InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data=back_callback),
        InlineKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞", callback_data='cancel_adding')
    ])
    keyboard.append([InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])

    reply_markup = InlineKeyboardMarkup(keyboard)

    text = (
        f"<b>‚ûï –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ú–ï–ù–´</b>\n\n"
        f"<b>üìÖ –î–∞—Ç–∞:</b> {context.user_data.get('date', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üìÖ –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</b> {context.user_data.get('day', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üè´ –ö–ª–∞—Å—Å:</b> {context.user_data.get('class_name', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üî¢ –£—Ä–æ–∫:</b> {context.user_data.get('lesson', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üìö –°—Ç–∞—Ä—ã–π –ø—Ä–µ–¥–º–µ—Ç:</b> {context.user_data.get('old_subject', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        f"<b>üìö –ù–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç:</b> {context.user_data.get('new_subject', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
    )
    if is_old:
        text += f"<b>üë®‚Äçüè´ –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ä–æ–≥–æ —É—á–∏—Ç–µ–ª—è:</b>"
    else:
        text += f"<b>üë®‚Äçüè´ –°—Ç–∞—Ä—ã–π —É—á–∏—Ç–µ–ª—å:</b> {context.user_data.get('old_teacher', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n"
        text += f"<b>üë®‚Äçüè´ –í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤–æ–≥–æ —É—á–∏—Ç–µ–ª—è:</b>"

    await query.edit_message_text(
        text,
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

async def save_substitution(query, context):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–º–µ–Ω—É –≤ –ë–î –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–º—É —É—á–∏—Ç–µ–ª—é."""
    date = context.user_data['date']
    day = context.user_data['day']
    class_name = context.user_data['class_name']
    lesson = context.user_data['lesson']
    old_subject = context.user_data['old_subject']
    new_subject = context.user_data['new_subject']
    old_teacher = context.user_data['old_teacher']
    new_teacher = context.user_data['new_teacher']

    try:
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–º–µ–Ω—É –≤ –ë–î
        db.add_substitution(
            date, day, lesson,
            old_subject, new_subject,
            old_teacher, new_teacher,
            class_name
        )

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–º—É —É—á–∏—Ç–µ–ª—é
        substitution_data = {
            'date': date,
            'day': day,
            'class_name': class_name,
            'lesson': lesson,
            'old_subject': old_subject,
            'new_subject': new_subject,
            'old_teacher': old_teacher,
            'new_teacher': new_teacher
        }
        await send_substitution_notification(context, new_teacher, substitution_data)

        context.user_data.clear()

        keyboard = add_start_button()
        reply_markup = InlineKeyboardMarkup(keyboard)

        success_message = (
            f"<b>‚úÖ –ó–∞–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</b>\n\n"
            f"<b>üìÖ –î–∞—Ç–∞:</b> {date}\n"
            f"<b>üìÖ –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</b> {day}\n"
            f"<b>üè´ –ö–ª–∞—Å—Å:</b> {class_name}\n"
            f"<b>üî¢ –£—Ä–æ–∫:</b> {lesson}\n"
            f"<b>üìö –°—Ç–∞—Ä—ã–π –ø—Ä–µ–¥–º–µ—Ç:</b> {old_subject}\n"
            f"<b>üìö –ù–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç:</b> ‚Üí <code>{new_subject}</code>\n"
            f"<b>üë®‚Äçüè´ –°—Ç–∞—Ä—ã–π —É—á–∏—Ç–µ–ª—å:</b> {old_teacher}\n"
            f"<b>üë®‚Äçüè´ –ù–æ–≤—ã–π —É—á–∏—Ç–µ–ª—å:</b> ‚Üí <code>{new_teacher}</code>\n\n"
            f"<i>–ó–∞–º–µ–Ω–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏ –∫–ª–∞—Å—Å–∞ {class_name.upper()} –∏ –≤ —Å–ø–∏—Å–∫–µ –∑–∞–º–µ–Ω.</i>"
        )

        await query.edit_message_text(
            success_message,
            reply_markup=reply_markup,
            parse_mode='HTML'
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–º–µ–Ω—ã: {e}")
        await query.edit_message_text(
            f"<b>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–º–µ–Ω—ã:</b>\n{str(e)[:100]}",
            parse_mode='HTML'
        )

# ================== –û–ë–†–ê–ë–û–¢–ö–ê –°–û–û–ë–©–ï–ù–ò–ô ==================
async def handle_message(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π."""
    if not update.message or not update.message.text:
        return

    # –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞ context.user_data
    if not isinstance(context.user_data, dict):
        context.user_data = {}

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏—â–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∏—Ç–µ–ª—è
    if context.user_data.get('searching_teacher'):
        search_query = update.message.text.strip()

        if not search_query:
            await update.message.reply_text(
                "<b>‚ùå –ü—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å.</b>\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é —É—á–∏—Ç–µ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞.",
                parse_mode='HTML'
            )
            return

        all_teachers = get_all_teachers()
        found_teachers = []
        for teacher in all_teachers:
            if search_query.lower() in teacher.lower():
                found_teachers.append(teacher)

        if found_teachers:
            text = f"<b>üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É '{search_query}':</b>\n\n"

            keyboard = []
            for i, teacher in enumerate(found_teachers[:10]):
                button_text = teacher
                if len(teacher) > 20:
                    button_text = teacher[:18] + "..."
                keyboard.append([InlineKeyboardButton(button_text, callback_data=f'teacher_search_{i}')])

            context.user_data['found_teachers'] = found_teachers

            keyboard.append([InlineKeyboardButton("üîç –ù–æ–≤—ã–π –ø–æ–∏—Å–∫", callback_data='menu_search_teacher')])
            keyboard.append([InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')])
            reply_markup = InlineKeyboardMarkup(keyboard)

            text += f"–ù–∞–π–¥–µ–Ω–æ —É—á–∏—Ç–µ–ª–µ–π: <b>{len(found_teachers)}</b>\n–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∏—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞:"

            await update.message.reply_text(text, reply_markup=reply_markup, parse_mode='HTML')
        else:
            keyboard = [
                [InlineKeyboardButton("üîç –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞", callback_data='menu_search_teacher')],
                [InlineKeyboardButton("üë®‚Äçüè´ –í—Å–µ —É—á–∏—Ç–µ–ª—è", callback_data='menu_teacher')],
                [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
            ]
            reply_markup = InlineKeyboardMarkup(keyboard)

            await update.message.reply_text(
                f"<b>‚ùå –£—á–∏—Ç–µ–ª—è –ø–æ –∑–∞–ø—Ä–æ—Å—É '{search_query}' –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</b>\n\n"
                f"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n"
                f"‚Ä¢ –£–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ñ–∞–º–∏–ª–∏—é\n"
                f"‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è\n"
                f"‚Ä¢ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö —É—á–∏—Ç–µ–ª–µ–π",
                reply_markup=reply_markup,
                parse_mode='HTML'
            )

        context.user_data['searching_teacher'] = False

    else:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É—á–∏—Ç–µ–ª—è–º
        await handle_teacher_mentions(update, context)

# ================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –£–ß–ò–¢–ï–õ–Ø–ú ==================
async def handle_teacher_mentions(update: Update, context: CallbackContext):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —É—á–∏—Ç–µ–ª–µ–π."""
    if not update.message or not update.message.text:
        return

    message_text = update.message.text
    user = update.message.from_user

    found_mentions = []

    for teacher_name, teacher_id in TEACHER_IDS.items():
        if not teacher_id or teacher_id == 0:
            continue

        pattern = r'\b' + re.escape(teacher_name.split()[0]) + r'\b'
        if re.search(pattern, message_text, re.IGNORECASE):
            found_mentions.append((teacher_name, teacher_id))

    if not found_mentions:
        return

    for teacher_name, teacher_id in found_mentions:
        try:
            notification = (
                f"<b>üîî –í–∞—Å —É–ø–æ–º—è–Ω—É–ª–∏ –≤ —à–∫–æ–ª—å–Ω–æ–º –±–æ—Ç–µ!</b>\n\n"
                f"<b>üë§ –û—Ç:</b> {user.full_name}\n"
                f"<b>üìÖ –í—Ä–µ–º—è:</b> {datetime.now().strftime('%H:%M %d.%m.%Y')}\n\n"
                f"<b>üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:</b>\n"
                f"<code>\n{message_text[:300]}\n</code>\n\n"
                f"<i>–ß—Ç–æ–±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å, –Ω–∞–∂–º–∏—Ç–µ ¬´–û—Ç–≤–µ—Ç–∏—Ç—å¬ª –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.</i>"
            )

            await context.bot.send_message(
                chat_id=teacher_id,
                text=notification,
                parse_mode='HTML'
            )

            keyboard = add_start_button()
            reply_markup = InlineKeyboardMarkup(keyboard)
            await update.message.reply_text(
                f"‚úÖ –£—á–∏—Ç–µ–ª—å <b>{teacher_name}</b> –ø–æ–ª—É—á–∏–ª(–∞) —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤–∞—à–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.",
                reply_markup=reply_markup,
                parse_mode='HTML'
            )

        except Exception as e:
            error_msg = str(e)
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è {teacher_name}: {error_msg}")

            keyboard = add_start_button()
            reply_markup = InlineKeyboardMarkup(keyboard)

            if "chat not found" in error_msg.lower():
                await update.message.reply_text(
                    f"‚ö†Ô∏è –£—á–∏—Ç–µ–ª—å <b>{teacher_name}</b> –Ω–µ –Ω–∞—á–∞–ª –¥–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º. "
                    f"–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å /start –±–æ—Ç—É.",
                    reply_markup=reply_markup,
                    parse_mode='HTML'
                )
            elif "blocked" in error_msg.lower():
                await update.message.reply_text(
                    f"‚ö†Ô∏è –£—á–∏—Ç–µ–ª—å <b>{teacher_name}</b> –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞.",
                    reply_markup=reply_markup,
                    parse_mode='HTML'
                )
            else:
                await update.message.reply_text(
                    f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ {teacher_name}: {error_msg[:100]}",
                    reply_markup=reply_markup,
                    parse_mode='HTML'
                )

# ================== –¢–ï–°–¢–û–í–ê–Ø –ö–û–ú–ê–ù–î–ê ==================
async def test_notification(update: Update, context: CallbackContext):
    """–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π."""
    if update.effective_user.id not in ADMIN_IDS:
        await update.message.reply_text("‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.", parse_mode='HTML')
        return

    if not context.args:
        teachers_list = "\n".join([f"‚Ä¢ {teacher}" for teacher in TEACHER_IDS.keys()])
        await update.message.reply_text(
            f"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /test [—Ñ–∞–º–∏–ª–∏—è —É—á–∏—Ç–µ–ª—è]\n\n"
            f"<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —É—á–∏—Ç–µ–ª—è:</b>\n{teachers_list}",
            parse_mode='HTML'
        )
        return

    teacher_name = context.args[0]

    found_teacher = None
    for teacher in TEACHER_IDS.keys():
        if teacher_name.lower() in teacher.lower():
            found_teacher = teacher
            break

    if not found_teacher:
        await update.message.reply_text(f"‚ùå –£—á–∏—Ç–µ–ª—å '{teacher_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø–∏—Å–∫–µ.", parse_mode='HTML')
        return

    teacher_id = TEACHER_IDS[found_teacher]
    if not teacher_id or teacher_id == 0:
        await update.message.reply_text(f"‚ùå –î–ª—è —É—á–∏—Ç–µ–ª—è '{found_teacher}' –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ID.", parse_mode='HTML')
        return

    try:
        test_message = (
            f"<b>üîî –¢–ï–°–¢–û–í–û–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï</b>\n\n"
            f"<b>üë®‚Äçüíª –û—Ç:</b> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –±–æ—Ç–∞\n"
            f"<b>üïê –í—Ä–µ–º—è:</b> {datetime.now().strftime('%H:%M %d.%m.%Y')}\n\n"
            f"‚úÖ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!\n\n"
            f"<i>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞.</i>"
        )

        await context.bot.send_message(
            chat_id=teacher_id,
            text=test_message,
            parse_mode='HTML'
        )

        keyboard = add_start_button()
        reply_markup = InlineKeyboardMarkup(keyboard)
        await update.message.reply_text(
            f"‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—á–∏—Ç–µ–ª—é <b>{found_teacher}</b> (ID: {teacher_id})",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )

    except Exception as e:
        error_msg = str(e)
        logger.error(f"–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏: {error_msg}")

        keyboard = add_start_button()
        reply_markup = InlineKeyboardMarkup(keyboard)

        if "chat not found" in error_msg.lower():
            await update.message.reply_text(
                f"‚ùå –£—á–∏—Ç–µ–ª—å <b>{found_teacher}</b> –Ω–µ –Ω–∞—á–∞–ª –¥–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º.\n"
                f"–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /start –±–æ—Ç—É.",
                reply_markup=reply_markup,
                parse_mode='HTML'
            )
        else:
            await update.message.reply_text(
                f"‚ùå –û—à–∏–±–∫–∞: {error_msg[:100]}",
                reply_markup=reply_markup,
                parse_mode='HTML'
            )

# ================== –°–ü–ò–°–û–ö –£–ß–ò–¢–ï–õ–ï–ô ==================
async def teachers_list(update: Update, context: CallbackContext):
    """–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —É—á–∏—Ç–µ–ª–µ–π."""
    all_teachers = get_all_teachers()

    if not all_teachers:
        await update.message.reply_text(
            "<b>‚ùå –°–ø–∏—Å–æ–∫ —É—á–∏—Ç–µ–ª–µ–π –ø—É—Å—Ç.</b>",
            parse_mode='HTML'
        )
        return

    teachers_text = "<b>üë®‚Äçüè´ –°–ü–ò–°–û–ö –£–ß–ò–¢–ï–õ–ï–ô:</b>\n\n"

    for i, teacher in enumerate(all_teachers, 1):
        teachers_text += f"{i}. {teacher}\n"
        if i % 10 == 0:
            teachers_text += "\n"

    keyboard = [
        [InlineKeyboardButton("üîç –ü–æ–∏—Å–∫ —É—á–∏—Ç–µ–ª—è", callback_data='menu_search_teacher')],
        [InlineKeyboardButton("üìã –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—á–∏—Ç–µ–ª–µ–π", callback_data='menu_teacher')],
        [InlineKeyboardButton("üè† –°—Ç–∞—Ä—Ç / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await update.message.reply_text(
        teachers_text,
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

# ================== –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ==================
def main():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞."""
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    try:
        db.init_db()
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        db.update_database_structure()
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
        print(f"‚ùå –û—à–∏–±–∫–∞ –ë–î: {e}")
    # –°–æ–∑–¥–∞–µ–º Application —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
    application = (
        Application.builder()
        .token(TOKEN)
        .read_timeout(REQUEST_TIMEOUT)
        .write_timeout(REQUEST_TIMEOUT)
        .connect_timeout(REQUEST_TIMEOUT)
        .pool_timeout(REQUEST_TIMEOUT)
        .build()
    )

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("test", test_notification))
    application.add_handler(CommandHandler("teachers", teachers_list))

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
    application.add_handler(CallbackQueryHandler(button_handler))

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    application.add_handler(
        MessageHandler(
            filters.TEXT & ~filters.COMMAND,
            handle_message
        )
    )

    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
    print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    print(f"üìä –í—Å–µ–≥–æ —É—á–∏—Ç–µ–ª–µ–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏: {len(get_all_teachers())}")
    print(f"üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã: {ADMIN_IDS}")
    print(f"‚è±Ô∏è –¢–∞–π–º–∞—É—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞: {REQUEST_TIMEOUT} —Å–µ–∫")

    try:
        application.run_polling(
            allowed_updates=Update.ALL_TYPES,
            drop_pending_updates=True
        )
    except KeyboardInterrupt:
        print("\nüõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        print(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        logger.critical(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")

if __name__ == '__main__':
    main()
